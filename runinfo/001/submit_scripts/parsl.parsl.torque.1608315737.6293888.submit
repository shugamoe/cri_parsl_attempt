#!/bin/bash

#PBS -l mem=2gb
#PBS -S /bin/bash
#PBS -N parsl.parsl.torque.1608315737.6293888
#PBS -m n
#PBS -l walltime=01:00:00
#PBS -l nodes=1:ppn=1
#PBS -o /gpfs/data/gao-lab/Julian/gaolab_hub/projects/prs_aa_ancestry/cri/sbayesr_parsl/runinfo/001/submit_scripts/parsl.parsl.torque.1608315737.6293888.submit.stdout
#PBS -e /gpfs/data/gao-lab/Julian/gaolab_hub/projects/prs_aa_ancestry/cri/sbayesr_parsl/runinfo/001/submit_scripts/parsl.parsl.torque.1608315737.6293888.submit.stderr

module load gcc/6.2.0; module load plink/2.0; module load python/3.8.1; python3 -c 'import parsl; print(parsl.__version__)'

export JOBNAME="parsl.parsl.torque.1608315737.6293888"

set -e
WORKERCOUNT=1

cat << APRUN_EOF > cmd_$JOBNAME.sh
process_worker_pool.py   -a 10.50.178.250 -p 0 -c 1 -m None --poll 10 --task_port=54183 --result_port=54924 --logdir=/gpfs/data/gao-lab/Julian/gaolab_hub/projects/prs_aa_ancestry/cri/sbayesr_parsl/runinfo/001/gardner_plink_1ppn --block_id=0 --hb_period=30  --hb_threshold=120 
APRUN_EOF
chmod a+x cmd_$JOBNAME.sh

aprun -n 1 -N 1  /bin/bash cmd_$JOBNAME.sh &
wait

echo "Done"


